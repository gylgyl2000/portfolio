"use strict";(self.webpackChunkmon_web_dev_wiki=self.webpackChunkmon_web_dev_wiki||[]).push([[3976],{41919:function(e,n,r){r.r(n),r.d(n,{frontMatter:function(){return l},contentTitle:function(){return d},metadata:function(){return u},toc:function(){return p},default:function(){return c}});var s=r(83117),a=r(80102),t=(r(67294),r(3905)),o=(r(26396),r(58215),r(56222)),i=["components"],l={sidebar_position:2},d="Cr\xe9ez un serveur Express simple",u={unversionedId:"OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Creez_un_serveur_Express_simple",id:"OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Creez_un_serveur_Express_simple",title:"Cr\xe9ez un serveur Express simple",description:"Tirez le maximum de ce cours",source:"@site/docs/OpenClassrooms/6-Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/2-Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/1-Creez_un_serveur_Express_simple.mdx",sourceDirName:"OpenClassrooms/6-Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/2-Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB",slug:"/OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Creez_un_serveur_Express_simple",permalink:"/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Creez_un_serveur_Express_simple",editUrl:"https://github.com/gylgyl2000/Mon_Web_Dev_Wiki/edit/master/website/docs/OpenClassrooms/6-Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/2-Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/1-Creez_un_serveur_Express_simple.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"openClassroomsSidebar",previous:{title:"Introduction du cours",permalink:"/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Introduction_du_cours"},next:{title:"Cr\xe9ez une API RESTful",permalink:"/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/Passez_au_Full_stack_avec_Node_js_Express_et_MongoDB/Creez_une_API_RESTful"}},p=[{value:"Tirez le maximum de ce cours",id:"tirez-le-maximum-de-ce-cours",children:[],level:2},{value:"Configurez votre environnement de d\xe9veloppement",id:"configurez-votre-environnement-de-d\xe9veloppement",children:[{value:"Installez Node",id:"installez-node",children:[],level:3},{value:"Installez Angular",id:"installez-angular",children:[],level:3},{value:"Clonez l&#39;application front-end",id:"clonez-lapplication-front-end",children:[],level:3}],level:2},{value:"D\xe9marrez votre serveur Node",id:"d\xe9marrez-votre-serveur-node",children:[{value:"Qu&#39;est-ce que\xa0Node ?",id:"quest-ce-quenode-",children:[],level:3},{value:"Initialisez votre projet",id:"initialisez-votre-projet",children:[],level:3},{value:"D\xe9marrez un serveur basique",id:"d\xe9marrez-un-serveur-basique",children:[],level:3},{value:"Installez nodemon",id:"installez-nodemon",children:[],level:3}],level:2},{value:"Cr\xe9ez une application Express",id:"cr\xe9ez-une-application-express",children:[{value:"Installez Express",id:"installez-express",children:[],level:3},{value:"Ex\xe9cutez l&#39;application\xa0Express\xa0sur le serveur Node",id:"ex\xe9cutez-lapplicationexpresssur-le-serveur-node",children:[],level:3},{value:"Ajoutez\xa0des middleware",id:"ajoutezdes-middleware",children:[],level:3},{value:"Am\xe9liorez\xa0server.js",id:"am\xe9liorezserverjs",children:[],level:3}],level:2},{value:"Cr\xe9ez une route GET",id:"cr\xe9ez-une-route-get",children:[{value:"Remettre des\xa0articles en vente",id:"remettre-desarticles-en-vente",children:[],level:3},{value:"Erreurs de CORS",id:"erreurs-de-cors",children:[],level:3}],level:2},{value:"Cr\xe9ez une route POST",id:"cr\xe9ez-une-route-post",children:[{value:"Recevez des\xa0articles de l&#39;application\xa0front-end",id:"recevez-desarticles-de-lapplicationfront-end",children:[],level:3},{value:"En r\xe9sum\xe9",id:"en-r\xe9sum\xe9",children:[],level:3}],level:2},{value:"Quiz : \xcates-vous pr\xeat \xe0 cr\xe9er un serveur Express ?",id:"quiz--\xeates-vous-pr\xeat-\xe0-cr\xe9er-un-serveur-express-",children:[{value:"Comp\xe9tences \xe9valu\xe9es",id:"comp\xe9tences-\xe9valu\xe9es",children:[],level:4},{value:"Question 1 : En cr\xe9ant un serveur HTTP avec Node, on utilise la fonction <code>createServer()</code>. On peut passer une fonction \xe0 <code>createServer()</code>\xa0qui r\xe9agira aux requ\xeates entrantes. Quels arguments re\xe7oit cette fonction pass\xe9e ?",id:"question-1--en-cr\xe9ant-un-serveur-http-avec-node-on-utilise-la-fonction-createserver-on-peut-passer-une-fonction-\xe0-createserverqui-r\xe9agira-aux-requ\xeates-entrantes-quels-arguments-re\xe7oit-cette-fonction-pass\xe9e-",children:[],level:4},{value:"Question 2 : Dans une application Express, que doit faire le dernier middleware pour une route donn\xe9e pour emp\xeacher les requ\xeates d&#39;expirer ?",id:"question-2--dans-une-application-express-que-doit-faire-le-dernier-middleware-pour-une-route-donn\xe9e-pour-emp\xeacher-les-requ\xeates-dexpirer-",children:[],level:4},{value:"Question 3 : \xc0 quoi sert la fonction <code>next()</code>\xa0?",id:"question-3--\xe0-quoi-sert-la-fonction-next",children:[],level:4},{value:"Question 4 : Un code HTTP de 200\xa0repr\xe9sente\xa0g\xe9n\xe9ralement :",id:"question-4--un-code-http-de-200repr\xe9senteg\xe9n\xe9ralement-",children:[],level:4},{value:"Question 5 : Un code HTTP de 201 repr\xe9sente g\xe9n\xe9ralement :",id:"question-5--un-code-http-de-201-repr\xe9sente-g\xe9n\xe9ralement-",children:[],level:4},{value:"Question 6 : Une erreur CORS peut survenir quand :",id:"question-6--une-erreur-cors-peut-survenir-quand-",children:[],level:4},{value:"Question 7 : Quelle m\xe9thode permet d&#39;emp\xeacher des erreurs CORS ?",id:"question-7--quelle-m\xe9thode-permet-demp\xeacher-des-erreurs-cors-",children:[],level:4},{value:"Question 8 : Le package <code>body-parser</code>\xa0:",id:"question-8--le-package-body-parser",children:[],level:4}],level:2}],m={toc:p};function c(e){var n=e.components,r=(0,a.Z)(e,i);return(0,t.mdx)("wrapper",(0,s.Z)({},m,r,{components:n,mdxType:"MDXLayout"}),(0,t.mdx)("h1",{id:"cr\xe9ez-un-serveur-express-simple"},"Cr\xe9ez un serveur Express simple"),(0,t.mdx)("h2",{id:"tirez-le-maximum-de-ce-cours"},"Tirez le maximum de ce cours"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6521356-tirez-le-maximum-de-ce-cours"},"Tirez le maximum de ce cours - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373137410",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Bienvenue dans ce cours sur Node, Express, et MongoDB\xa0!"),(0,t.mdx)("div",{className:"admonition admonition-info alert alert--info"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Je suis ",(0,t.mdx)("strong",{parentName:"p"},"William Alexander"),", ",(0,t.mdx)("strong",{parentName:"p"},"D\xe9veloppeur full stack")," depuis de nombreuses ann\xe9es, et je suis ravi de vous accompagner tout au\nlong de votre apprentissage du d\xe9veloppement back-end avec Javascript."))),(0,t.mdx)("p",null,"Ce cours est destin\xe9 aux d\xe9veloppeurs ayant d\xe9j\xe0 des connaissances en JavaScript. G\xe9n\xe9ralement, on commence l'apprentissage de\nJavaScript par toute la partie\xa0",(0,t.mdx)("strong",{parentName:"p"},"front-end")," : la cr\xe9ation de pages Web dynamiques, avec manipulations du DOM et interactions\nutilisateur par exemple."),(0,t.mdx)("p",null,"L'objectif de ce cours est de vous aider \xe0 appliquer vos connaissances JavaScript sur des technologies\xa0",(0,t.mdx)("strong",{parentName:"p"},"back-end"),"\xa0(Node, Express et\nMongoDB) afin de cr\xe9er des serveurs complets permettant d'interagir avec des bases de donn\xe9es."),(0,t.mdx)("p",null,"Tout cela dans l'id\xe9e de devenir un d\xe9veloppeur\xa0",(0,t.mdx)("strong",{parentName:"p"},"full stack"),", autrement dit un d\xe9veloppeur capable de cr\xe9er tous les \xe9l\xe9ments\nn\xe9cessaires \xe0 une application Web compl\xe8te : back-end\xa0",(0,t.mdx)("em",{parentName:"p"},"et")," front-end."),(0,t.mdx)("div",{className:"admonition admonition-info alert alert--info"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Si vous souhaitez en apprendre plus sur le d\xe9veloppement Web,\xa0allez d\xe9couvrir notre parcours de\xa0",(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/paths/48-developpeur-web-junior"},"D\xe9veloppeur Web Junior"),"\xa0!"))),(0,t.mdx)("p",null,"Parlons maintenant de la structure de ce cours afin que vous puissiez en tirer parti au maximum en toute autonomie !"),(0,t.mdx)("p",null,"Chaque chapitre de ce cours commence par une ",(0,t.mdx)("strong",{parentName:"p"},"vid\xe9o"),", o\xf9 je donne un aper\xe7u de\xa0ce qui sera abord\xe9 dans le chapitre, ainsi que\nquelques explications."),(0,t.mdx)("p",null,"Ensuite, dans le ",(0,t.mdx)("strong",{parentName:"p"},"texte")," du cours,\xa0je vous explique les concepts du chapitre en d\xe9tail, et je vous guide dans la mise en pratique\nde ces concepts. Vous y trouverez \xe9galement des\xa0",(0,t.mdx)("strong",{parentName:"p"},"screencasts"),", c'est-\xe0-dire des enregistrements vid\xe9o de mon \xe9cran, pour vous\nmontrer ce que je vous explique dans le chapitre."),(0,t.mdx)("div",{className:"admonition admonition-info alert alert--info"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Je vous encourage \xe0 suivre ce cours\xa0",(0,t.mdx)("strong",{parentName:"p"},"en codant"),". Le d\xe9veloppement \xe9tant un m\xe9tier\xa0",(0,t.mdx)("strong",{parentName:"p"},"pratique"),", pratiquer en apprenant est la\nmeilleure fa\xe7on de comprendre et de retenir !"))),(0,t.mdx)("p",null,"\xc0 la fin de chaque partie du cours, un\xa0",(0,t.mdx)("strong",{parentName:"p"},"quiz")," vous permettra de v\xe9rifier vos nouvelles connaissances et d'identifier les chapitres\n\xe0 revoir si n\xe9cessaire."),(0,t.mdx)("p",null,"Vous \xeates pr\xeat ? Alors je vous propose de me rejoindre d\xe8s maintenant dans le prochain chapitre !"),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"configurez-votre-environnement-de-d\xe9veloppement"},"Configurez votre environnement de d\xe9veloppement"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6466206-configurez-votre-environnement-de-developpement"},"Configurez votre environnement de d\xe9veloppement - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373138409",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Avant de pouvoir commencer \xe0 coder, vous devrez installer quelques outils. Commen\xe7ons par installer le ",(0,t.mdx)("em",{parentName:"p"},"runtime")," de Node."),(0,t.mdx)("h3",{id:"installez-node"},"Installez Node"),(0,t.mdx)("p",null,"Acc\xe9dez \xe0\xa0",(0,t.mdx)("a",{parentName:"p",href:"https://nodejs.org/en/"},"NodeJS.org"),"\xa0pour t\xe9l\xe9charger puis installer la derni\xe8re version de Node. Cela a pour effet\nd'installer le ",(0,t.mdx)("em",{parentName:"p"},"runtime")," JavaScript de Node,\xa0ce qui vous permet par l\xe0 m\xeame d'ex\xe9cuter les serveurs Node. Cela installe \xe9galement\n",(0,t.mdx)("strong",{parentName:"p"},"Node Package Manager")," ou\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm"),", outil pr\xe9cieux pour l'installation des packages n\xe9cessaires \xe0 la cr\xe9ation de vos projets."),(0,t.mdx)("h3",{id:"installez-angular"},"Installez Angular"),(0,t.mdx)("p",null,"Il vous faudra \xe9galement la ",(0,t.mdx)("strong",{parentName:"p"},"CLI\xa0Angular")," pour pouvoir\xa0faire tourner\xa0le serveur de d\xe9veloppement sur lequel sera ex\xe9cut\xe9 le code\ndu front-end. Pour l'installer, ex\xe9cutez la commande suivante \xe0 partir de\xa0votre console\xa0:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"npm install -g @angular/cli\n")),(0,t.mdx)("div",{className:"admonition admonition-caution alert alert--warning"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"!")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Les utilisateurs Mac devront peut-\xeatre ajouter\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"sudo"),"\xa0pour que cela fonctionne. Pour plus d'informations sur l'utilisation de\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm"),"\nsur MacOS, reportez-vous \xe0 la page ",(0,t.mdx)("a",{parentName:"p",href:"https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally"},(0,t.mdx)("em",{parentName:"a"},"Resolving EACCES permissions errors when installing packages globally")),",\nissue de la documentation de\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm"),"."))),(0,t.mdx)("h3",{id:"clonez-lapplication-front-end"},"Clonez l'application front-end"),(0,t.mdx)("p",null,"Il est maintenant temps de cr\xe9er votre r\xe9pertoire de travail pour ce cours : vous pouvez le nommer\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"go-fullstack")," par exemple."),(0,t.mdx)("p",null,"Une fois le r\xe9pertoire cr\xe9\xe9,\xa0il vous faudra cloner ",(0,t.mdx)("a",{parentName:"p",href:"https://github.com/OpenClassrooms-Student-Center/go-fullstack-fr-frontend.git"},"le code pour l'application front-end"),"\ndans un sous-r\xe9pertoire appel\xe9 ",(0,t.mdx)("inlineCode",{parentName:"p"},"frontend"),". \xc0 partir de votre r\xe9pertoire de travail, entrez la commande ci-dessous :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"git clone\xa0https://github.com/OpenClassrooms-Student-Center/go-fullstack-fr-frontend.git frontend\n")),(0,t.mdx)("p",null,"Vous pouvez ensuite proc\xe9der comme suit :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"cd frontend\nnpm install\nng serve\n")),(0,t.mdx)("p",null,"Cela installera toutes les d\xe9pendances requises par l'application front-end et lancera le serveur de d\xe9veloppement. D\xe9sormais,\xa0si\nvous acc\xe9dez \xe0\xa0",(0,t.mdx)("a",{parentName:"p",href:"http://localhost:4200"},"http://localhost:4200"),", vous devriez voir l'interface suivante (en supposant que vous avez\nbien suivi les \xe9tapes ci-dessus) :"),(0,t.mdx)("figure",null,(0,t.mdx)("img",{src:"https://user.oc-static.com/upload/2019/09/29/15697612456291_Screenshot%202019-09-29%20at%2014.47.04.png",alt:"Page d'accueil de l'application front-end"}),(0,t.mdx)("figcaption",null,"Page d'accueil de l'application front-end")),(0,t.mdx)("p",null,"N'h\xe9sitez pas \xe0 explorer le contenu pour avoir un aper\xe7u de ce que nous allons cr\xe9er.\xa0\xc7a ne repr\xe9sente pas encore beaucoup, mais\nc'est l\xe0 que vous intervenez !"),(0,t.mdx)("p",null,"La derni\xe8re \xe9tape consiste \xe0 cr\xe9er un second sous-r\xe9pertoire dans votre r\xe9pertoire de travail, appel\xe9\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"backend"),". C'est l\xe0 que vous\ncr\xe9erez l'application Express."),(0,t.mdx)("div",{className:"admonition admonition-caution alert alert--warning"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"!")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Veillez \xe0 avoir toujours un terminal qui ex\xe9cute\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"ng serve"),"\xa0lorsque vous travaillez sur ce cours. De cette fa\xe7on, vous pourrez\ntoujours tester\xa0votre code en temps r\xe9el !"))),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"d\xe9marrez-votre-serveur-node"},"D\xe9marrez votre serveur Node"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6466231-demarrez-votre-serveur-node"},"D\xe9marrez votre serveur Node - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373138160",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("h3",{id:"quest-ce-quenode-"},"Qu'est-ce que\xa0Node ?"),(0,t.mdx)("p",null,"Avant de nous lancer dans l'\xe9criture du code, qu'est-ce que\xa0Node ? Qu'est-ce qu'Express ? Y-a-t-il une diff\xe9rence ?"),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Node"),"\xa0est le\xa0",(0,t.mdx)("em",{parentName:"p"},(0,t.mdx)("strong",{parentName:"em"},"runtime"))," qui permet d'\xe9crire toutes nos t\xe2ches c\xf4t\xe9 serveur, en JavaScript, telles que la logique m\xe9tier, la\npersistance des donn\xe9es et la s\xe9curit\xe9. Node ajoute \xe9galement des fonctionnalit\xe9s que le JavaScript du navigateur standard ne\nposs\xe8de pas, comme par exemple l'acc\xe8s au syst\xe8me de fichiers local."),(0,t.mdx)("p",null,(0,t.mdx)("strong",{parentName:"p"},"Express"),"\xa0est, pour faire court, un\xa0",(0,t.mdx)("strong",{parentName:"p"},"framework"),"\xa0reposant sur Node qui facilite la cr\xe9ation et la gestion des serveurs\xa0Node,\ncomme vous le verrez \xe0 mesure que nous progresserons dans ce cours."),(0,t.mdx)("h3",{id:"initialisez-votre-projet"},"Initialisez votre projet"),(0,t.mdx)("p",null,"\xc0 partir de votre dossier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"backend"),",\xa0ex\xe9cutez la commande de terminal\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm init"),"\xa0pour initialiser votre projet. Vous pouvez utiliser\nles options par d\xe9faut ou les modifier\xa0si vous le souhaitez. Cependant, votre point d'entr\xe9e doit \xeatre\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"server.js"),". Vous le cr\xe9erez\nbient\xf4t."),(0,t.mdx)(o.fG,{vimeoId:"374617448",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Ce processus g\xe9n\xe8re un fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"package.json"),"\xa0vierge,\xa0dans lequel seront enregistr\xe9s\xa0les d\xe9tails de tous les packages\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm"),"\xa0que nous\nutiliserons pour ce projet."),(0,t.mdx)("p",null,"\xc0 ce stade, vous pouvez initialiser un\xa0d\xe9p\xf4t Git en ex\xe9cutant\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"git init"),"\xa0depuis\xa0votre dossier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"backend"),". N'oubliez pas de cr\xe9er un\nfichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},".gitignore"),"\xa0contenant la ligne\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"node_modules"),"\xa0afin de ne pas envoyer ce dossier (qui deviendra volumineux) vers votre d\xe9p\xf4t\ndistant."),(0,t.mdx)("p",null,"Cr\xe9ez un fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"server.js"),"\xa0\xe0 l'int\xe9rieur de votre dossier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"backend"),". Il contiendra votre premier serveur Node."),(0,t.mdx)("h3",{id:"d\xe9marrez-un-serveur-basique"},"D\xe9marrez un serveur basique"),(0,t.mdx)(o.fG,{vimeoId:"374617465",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Pour cr\xe9er un serveur\xa0Node\xa0dans votre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"server.js"),", il vous faudra le code suivant :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const http = require('http');\n\nconst server = http.createServer((req, res) => {\n    res.end('Voil\xe0 la r\xe9ponse du serveur !');\n});\n\nserver.listen(process.env.PORT || 3000);\n")),(0,t.mdx)("p",null,"Ici,\xa0vous importez le package HTTP natif de\xa0Node\xa0et l'utilisez pour cr\xe9er un serveur, en passant une fonction qui sera ex\xe9cut\xe9e \xe0\nchaque appel effectu\xe9 vers ce serveur. Cette fonction re\xe7oit les objets\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"request"),"\xa0et\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"response"),"\xa0en tant qu'arguments. Dans cet\nexemple, vous utilisez la m\xe9thode\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"end"),"\xa0de la r\xe9ponse pour renvoyer une r\xe9ponse de type\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"string"),"\xa0\xe0 l'appelant."),(0,t.mdx)("p",null,"Dans la derni\xe8re ligne, vous configurez le serveur pour qu'il \xe9coute :"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},"soit la variable d'environnement du port gr\xe2ce \xe0\xa0",(0,t.mdx)("inlineCode",{parentName:"li"},"process.env.PORT"),"\xa0: si la plateforme de d\xe9ploiement propose un port par d\xe9faut,\nc'est celui-ci qu'on \xe9coutera ;"),(0,t.mdx)("li",{parentName:"ul"},"soit le port 3000, ce qui nous servira dans le cas de notre plateforme de d\xe9veloppement.")),(0,t.mdx)("p",null,"D\xe9marrez le serveur en ex\xe9cutant\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"node server"),"\xa0\xe0 partir de la ligne de commande. Pour v\xe9rifier qu'il envoie la r\xe9ponse correcte,\nutilisez une fen\xeatre de navigateur pour acc\xe9der \xe0\xa0",(0,t.mdx)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000"),"\xa0(en supposant que vous ayez bien\nsuivi les \xe9tapes ci-dessus)."),(0,t.mdx)("p",null,"Vous pouvez \xe9galement utiliser un outil de test tel que\xa0",(0,t.mdx)("a",{parentName:"p",href:"https://www.getpostman.com"},"Postman"),"\xa0pour effectuer une requ\xeate GET (ou\ntout autre type de requ\xeate d'ailleurs,\xa0car notre serveur ne fait actuellement aucune distinction !)\xa0vers la m\xeame URL :\n",(0,t.mdx)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000"),"\xa0(\xe0 nouveau, en supposant que vous ayez bien suivi les \xe9tapes ci-dessus)."),(0,t.mdx)("h3",{id:"installez-nodemon"},"Installez nodemon"),(0,t.mdx)(o.fG,{vimeoId:"374617488",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Pour simplifier le d\xe9veloppement Node, vous souhaiterez peut-\xeatre installer\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"nodemon"),". Pour ce faire, ex\xe9cutez la commande suivante :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"npm install -g nodemon\n")),(0,t.mdx)("p",null,"D\xe9sormais,\xa0au lieu d'utiliser\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"node server"),"\xa0pour d\xe9marrer votre serveur, vous pouvez utiliser\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"nodemon server"),". Il surveillera les\nmodifications de vos fichiers et red\xe9marrera le serveur lorsqu'il aura besoin d'\xeatre mis \xe0 jour. Cela vous garantit\xa0d'avoir toujours\nla derni\xe8re version de votre serveur d\xe8s que vous sauvegardez, sans devoir relancer manuellement le serveur ! Vous n'aurez qu'\xe0\nrelancer la requ\xeate vers votre serveur. Pratique, n'est-ce pas ?"),(0,t.mdx)("p",null,"Maintenant que vous savez d\xe9marrer un serveur de d\xe9veloppement\xa0Node,\xa0dans le chapitre suivant, nous ajouterons\xa0Express\xa0au projet\npour simplifier encore plus la cr\xe9ation de notre\xa0API."),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"cr\xe9ez-une-application-express"},"Cr\xe9ez une application Express"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6466277-creez-une-application-express"},"Cr\xe9ez une application Express - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373138219",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Coder des serveurs Web en Node pur est possible, mais long et laborieux. En effet, cela exige d'analyser manuellement chaque demande\nentrante.\xa0L'utilisation du framework\xa0Express simplifie ces t\xe2ches, en nous permettant de d\xe9ployer nos API beaucoup plus rapidement.\nInstallons-le maintenant."),(0,t.mdx)("h3",{id:"installez-express"},"Installez Express"),(0,t.mdx)(o.fG,{vimeoId:"374617506",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Pour ajouter\xa0Express \xe0 votre projet,\xa0ex\xe9cutez la commande suivante \xe0 partir de votre dossier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"backend"),"\xa0:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"npm install --save express\n")),(0,t.mdx)("p",null,"Cr\xe9ez un fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"app.js"),", o\xf9 vous placerez votre application\xa0Express :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const express = require('express');\n\nconst app = express();\n\nmodule.exports = app;\n")),(0,t.mdx)("h3",{id:"ex\xe9cutez-lapplicationexpresssur-le-serveur-node"},"Ex\xe9cutez l'application\xa0Express\xa0sur le serveur Node"),(0,t.mdx)(o.fG,{vimeoId:"374617323",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Revenez \xe0 votre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"server.js"),"\xa0et modifiez-le comme suit :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const http = require('http');\nconst app = require('./app');\n\napp.set('port', process.env.PORT || 3000);\nconst server = http.createServer(app);\n\nserver.listen(process.env.PORT || 3000);\n")),(0,t.mdx)("p",null,"Effectuer une demande vers ce serveur g\xe9n\xe9rera une erreur 404,\xa0car notre application n'a encore aucun moyen de r\xe9pondre. Configurons\nune r\xe9ponse simple pour\xa0nous assurer que tout fonctionne correctement, en effectuant un ajout \xe0 notre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"app.js"),"\xa0:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const express = require('express');\n\nconst app = express();\n\napp.use((req, res) => {\n    res.json({ message: 'Votre requ\xeate a bien \xe9t\xe9 re\xe7ue !' });\n});\n\nmodule.exports = app;\n")),(0,t.mdx)("p",null,"Si vous essayez d'effectuer une\xa0requ\xeate \xe0 votre serveur, vous devez r\xe9cup\xe9rer un objet\xa0JSON\xa0contenant le message que nous avons\nsp\xe9cifi\xe9."),(0,t.mdx)("p",null,"Maintenant que notre serveur\xa0Node\xa0g\xe8re correctement notre application Express, voyons comment nous pouvons\xa0ajouter des fonctionnalit\xe9s\n\xe0 l'application."),(0,t.mdx)("h3",{id:"ajoutezdes-middleware"},"Ajoutez\xa0des middleware"),(0,t.mdx)("p",null,"Une application\xa0Express est fondamentalement une s\xe9rie de fonctions appel\xe9es\xa0",(0,t.mdx)("strong",{parentName:"p"},(0,t.mdx)("em",{parentName:"strong"},"middleware")),".\xa0Chaque \xe9l\xe9ment de\xa0",(0,t.mdx)("em",{parentName:"p"},"middleware")," re\xe7oit\nles objets\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"request"),"\xa0et ",(0,t.mdx)("inlineCode",{parentName:"p"},"response"),", peut les lire, les analyser et les manipuler, le cas \xe9ch\xe9ant. Le\xa0",(0,t.mdx)("em",{parentName:"p"},"middleware")," Express re\xe7oit\n\xe9galement la m\xe9thode\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"next"),", qui permet \xe0 chaque ",(0,t.mdx)("em",{parentName:"p"},"middleware")," de passer l'ex\xe9cution au ",(0,t.mdx)("em",{parentName:"p"},"middleware")," suivant. Voyons comment tout cela\nfonctionne."),(0,t.mdx)(o.fG,{vimeoId:"374617346",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const express = require('express');\n\nconst app = express();\n\napp.use((req, res, next) => {\n    console.log('Requ\xeate re\xe7ue !');\n    next();\n});\n\napp.use((req, res, next) => {\n    res.status(201);\n    next();\n});\n\napp.use((req, res, next) => {\n    res.json({ message: 'Votre requ\xeate a bien \xe9t\xe9 re\xe7ue !' });\n    next();\n});\n\napp.use((req, res, next) => {\n    console.log('R\xe9ponse envoy\xe9e avec succ\xe8s !');\n});\n\nmodule.exports = app;\n")),(0,t.mdx)("p",null,"Cette application\xa0Express\xa0contient quatre \xe9l\xe9ments de ",(0,t.mdx)("em",{parentName:"p"},"middleware")," :"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},"le premier enregistre\xa0\xab Requ\xeate re\xe7ue ! \xbb dans la console et passe l'ex\xe9cution ;"),(0,t.mdx)("li",{parentName:"ul"},"le deuxi\xe8me ajoute un code d'\xe9tat 201\xa0\xe0 la r\xe9ponse et passe l'ex\xe9cution ;"),(0,t.mdx)("li",{parentName:"ul"},"le troisi\xe8me envoie la r\xe9ponse\xa0JSON\xa0et passe l'ex\xe9cution ;"),(0,t.mdx)("li",{parentName:"ul"},"le dernier \xe9l\xe9ment\xa0de\xa0",(0,t.mdx)("em",{parentName:"li"},"middleware")," enregistre \xab\xa0R\xe9ponse envoy\xe9e avec succ\xe8s ! \xbb dans la console.")),(0,t.mdx)("p",null,"Il s'agit\xa0d'un serveur tr\xe8s simple et qui ne fait pas grand-chose pour l'instant, mais il illustre comment le ",(0,t.mdx)("em",{parentName:"p"},"middleware")," fonctionne\ndans une application\xa0Express."),(0,t.mdx)("h3",{id:"am\xe9liorezserverjs"},"Am\xe9liorez\xa0server.js"),(0,t.mdx)("p",null,"Avant\xa0d'aller plus loin dans le cours,\xa0apportons quelques am\xe9liorations \xe0 notre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"server.js"),",\xa0pour le rendre plus stable et\nappropri\xe9 pour le d\xe9ploiement :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const http = require('http');\nconst app = require('./app');\n\nconst normalizePort = val => {\n    const port = parseInt(val, 10);\n\n    if (isNaN(port)) {\n        return val;\n    }\n    if (port >= 0) {\n        return port;\n    }\n    return false;\n};\nconst port = normalizePort(process.env.PORT || '3000');\napp.set('port', port);\n\nconst errorHandler = error => {\n    if (error.syscall !== 'listen') {\n        throw error;\n    }\n    const address = server.address();\n    const bind = typeof address === 'string' ? 'pipe ' + address : 'port: ' + port;\n    switch (error.code) {\n        case 'EACCES':\n            console.error(bind + ' requires elevated privileges.');\n            process.exit(1);\n            break;\n        case 'EADDRINUSE':\n            console.error(bind + ' is already in use.');\n            process.exit(1);\n            break;\n        default:\n            throw error;\n    }\n};\n\nconst server = http.createServer(app);\n\nserver.on('error', errorHandler);\nserver.on('listening', () => {\n    const address = server.address();\n    const bind = typeof address === 'string' ? 'pipe ' + address : 'port ' + port;\n    console.log('Listening on ' + bind);\n});\n\nserver.listen(port);\n")),(0,t.mdx)("p",null,"Aper\xe7u rapide de ce qui se passe ici :"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},"la fonction\xa0",(0,t.mdx)("inlineCode",{parentName:"li"},"normalizePort"),"\xa0renvoie un port valide, qu'il soit fourni sous la forme d'un\xa0num\xe9ro ou d'une cha\xeene ;"),(0,t.mdx)("li",{parentName:"ul"},"la fonction\xa0",(0,t.mdx)("inlineCode",{parentName:"li"},"errorHandler")," recherche les diff\xe9rentes erreurs et les g\xe8re de mani\xe8re appropri\xe9e. Elle est ensuite enregistr\xe9e dans\nle serveur ;"),(0,t.mdx)("li",{parentName:"ul"},"un \xe9couteur d'\xe9v\xe8nements est \xe9galement enregistr\xe9, consignant le port ou le canal nomm\xe9 sur lequel le serveur s'ex\xe9cute dans la\nconsole.")),(0,t.mdx)("p",null,"Notre serveur de d\xe9veloppement\xa0Node est \xe0 pr\xe9sent op\xe9rationnel.\xa0Vous pouvez ainsi ajouter les fonctionnalit\xe9s appropri\xe9es \xe0\nl'application\xa0Express."),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"cr\xe9ez-une-route-get"},"Cr\xe9ez une route GET"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6466298-creez-une-route-get"},"Cr\xe9ez une route GET - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373138300",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Il est temps d'ajouter les fonctionnalit\xe9s dont notre application\xa0front-end\xa0a besoin et de regarder le syst\xe8me complet prendre forme !"),(0,t.mdx)("p",null,"Votre application\xa0front-end\xa0doit s'ex\xe9cuter dans un navigateur. Ex\xe9cutez donc\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"ng serve"),"\xa0\xe0 partir du r\xe9pertoire front-end, acc\xe9dez \xe0\n",(0,t.mdx)("a",{parentName:"p",href:"http://localhost:4200"},"http://localhost:4200"),"\xa0avec votre navigateur puis\xa0cliquez sur \xab Parties 1 + 2 \xbb."),(0,t.mdx)("h3",{id:"remettre-desarticles-en-vente"},"Remettre des\xa0articles en vente"),(0,t.mdx)(o.fG,{vimeoId:"374617370",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Comme vous avez pu le remarquer,\xa0l'application front-end\xa0affiche actuellement\xa0un ",(0,t.mdx)("em",{parentName:"p"},"spinner")," et indique une erreur dans la console.\nCela est d\xfb au fait qu'elle tente d'acc\xe9der \xe0 notre API (qui n'existe pas encore !) et de r\xe9cup\xe9rer les articles en vente. Essayons\nde rendre ces\xa0articles\xa0accessibles."),(0,t.mdx)("p",null,"Dans votre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"app.js"),", remplacez tout le ",(0,t.mdx)("em",{parentName:"p"},"middleware")," par le suivant :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"app.use('/api/stuff', (req, res, next) => {\n    const stuff = [\n        {\n            _id: 'oeihfzeoi',\n            title: 'Mon premier objet',\n            description: 'Les infos de mon premier objet',\n            imageUrl: 'https://cdn.pixabay.com/photo/2019/06/11/18/56/camera-4267692_1280.jpg',\n            price: 4900,\n            userId: 'qsomihvqios',\n        },\n        {\n            _id: 'oeihfzeomoihi',\n            title: 'Mon deuxi\xe8me objet',\n            description: 'Les infos de mon deuxi\xe8me objet',\n            imageUrl: 'https://cdn.pixabay.com/photo/2019/06/11/18/56/camera-4267692_1280.jpg',\n            price: 2900,\n            userId: 'qsomihvqios',\n        },\n    ];\n    res.status(200).json(stuff);\n});\n")),(0,t.mdx)("p",null,"La premi\xe8re diff\xe9rence que vous remarquerez est l'argument suppl\xe9mentaire pass\xe9 \xe0 la m\xe9thode\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"use"),"\xa0: nous lui passons un ",(0,t.mdx)("em",{parentName:"p"},"string"),",\ncorrespondant\xa0\xe0 la route\xa0pour\xa0laquelle\xa0nous souhaitons enregistrer cet \xe9l\xe9ment de ",(0,t.mdx)("em",{parentName:"p"},"middleware"),". Dans ce cas,\xa0cette route sera\n",(0,t.mdx)("inlineCode",{parentName:"p"},"http://localhost:3000/api/stuff"),",\xa0car il s'agit de l'URL demand\xe9e par l'application\xa0front-end."),(0,t.mdx)("p",null,"Dans ce\xa0",(0,t.mdx)("em",{parentName:"p"},"middleware"),",\xa0nous cr\xe9ons un groupe\xa0d'articles\xa0avec le sch\xe9ma de donn\xe9es sp\xe9cifique requis par le\xa0front-end.\xa0Nous envoyons\nensuite ces articles sous la forme de donn\xe9es\xa0JSON,\xa0avec un\xa0code 200 pour une demande r\xe9ussie."),(0,t.mdx)("p",null,"Si vous effectuez une demande GET\xa0vers cette route (aussi appel\xe9e ",(0,t.mdx)("em",{parentName:"p"},"endpoint"),")\xa0\xe0 partir de\xa0Postman, vous verrez que vous recevrez le\ngroupe de\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"stuff"),"\xa0mais que l'actualisation du navigateur ne semble pas fonctionner. Que se passe-t-il donc exactement ici ?"),(0,t.mdx)("h3",{id:"erreurs-de-cors"},"Erreurs de CORS"),(0,t.mdx)("p",null,"CORS\xa0signifie\xa0\xab\xa0",(0,t.mdx)("strong",{parentName:"p"},"Cross Origin Resource Sharing")," \xbb. Il s'agit d'un syst\xe8me de s\xe9curit\xe9 qui, par d\xe9faut, bloque les appels HTTP d'\xeatre\neffectu\xe9s entre des serveurs diff\xe9rents, ce qui emp\xeache donc les\xa0requ\xeates malveillantes d'acc\xe9der \xe0 des ressources sensibles. Dans\nnotre cas, nous avons deux origines :\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"localhost:3000"),"\xa0et\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"localhost:4200"),", et nous souhaiterions qu'elles puissent communiquer entre\nelles. Pour cela, nous devons ajouter des\xa0headers \xe0 notre objet ",(0,t.mdx)("inlineCode",{parentName:"p"},"response"),"."),(0,t.mdx)(o.fG,{vimeoId:"374617404",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"De retour au fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"app.js"),"\xa0,\xa0ajoutez le\xa0",(0,t.mdx)("em",{parentName:"p"},"middleware")," suivant avant la route d'API :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"app.use((req, res, next) => {\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content, Accept, Content-Type, Authorization');\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');\n    next();\n});\n")),(0,t.mdx)("p",null,"Ces headers permettent :"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},"d'acc\xe9der \xe0 notre API depuis n'importe quelle origine (",(0,t.mdx)("inlineCode",{parentName:"li"},"'*'"),") ;"),(0,t.mdx)("li",{parentName:"ul"},"d'ajouter les headers mentionn\xe9s aux requ\xeates envoy\xe9es vers notre API (",(0,t.mdx)("inlineCode",{parentName:"li"},"Origin"),",\xa0",(0,t.mdx)("inlineCode",{parentName:"li"},"X-Requested-With"),", etc.) ;"),(0,t.mdx)("li",{parentName:"ul"},"d'envoyer des requ\xeates avec les m\xe9thodes mentionn\xe9es (",(0,t.mdx)("inlineCode",{parentName:"li"},"GET"),", ",(0,t.mdx)("inlineCode",{parentName:"li"},"POST"),", etc.).")),(0,t.mdx)("p",null,"Comme vous pouvez le voir dans le code, le ",(0,t.mdx)("em",{parentName:"p"},"middleware")," ne prend pas d'adresse en premier param\xe8tre\xa0afin de s'appliquer \xe0 toutes les\nroutes. Cela permettra \xe0 toutes les demandes de toutes les origines d'acc\xe9der \xe0 votre API.\xa0Vous pouvez \xe9galement ajouter des URL\nd'images valides\xa0aux\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"stuff"),"\xa0renvoy\xe9s par l'API, en terminant la route GET.\xa0Si vous actualisez \xe0 pr\xe9sent l'application\xa0front-end,\nvous devriez voir vos\xa0articles en vente :"),(0,t.mdx)("figure",null,(0,t.mdx)("img",{src:"https://user.oc-static.com/upload/2019/11/05/15729833197549_Screenshot%202019-11-05%20at%2020.47.56.png",alt:""}),(0,t.mdx)("figcaption",null)),(0,t.mdx)("p",null,"Maintenant que vous avez correctement impl\xe9ment\xe9 une route\xa0basique pour\xa0remettre les\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"stuff"),"\xa0en vente, voyons comment autoriser les\nutilisateurs \xe0 proposer leurs propres articles \xe0 la vente."),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"cr\xe9ez-une-route-post"},"Cr\xe9ez une route POST"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/6466326-creez-une-route-post"},"Cr\xe9ez une route POST - Passez au Full stack avec Node.js, Express et MongoDB - OpenClassrooms")),(0,t.mdx)(o.fG,{vimeoId:"373128869",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("h3",{id:"recevez-desarticles-de-lapplicationfront-end"},"Recevez des\xa0articles de l'application\xa0front-end"),(0,t.mdx)("p",null,"Bien que nous ne puissions pas, pour le moment, stocker de donn\xe9es envoy\xe9es par l'utilisateur, puisque nous n'avons configur\xe9 aucune\nbase de donn\xe9es, nous pouvons du moins veiller \xe0 recevoir correctement les donn\xe9es du\xa0front-end. L'application\xa0front-end contient un\nformulaire \xab Vendre un article \xbb,\xa0qui envoie une demande POST (contenant\xa0l'article \xe0 vendre) \xe0 notre\xa0route\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"api/stuff"),". Voyons comment\nnous pouvons capturer ces donn\xe9es."),(0,t.mdx)(o.fG,{vimeoId:"374617427",mdxType:"Vimeo"}),(0,t.mdx)("br",null),(0,t.mdx)("p",null,"Pour g\xe9rer la demande\xa0POST\xa0provenant de l'application front-end,\xa0nous devrons \xeatre capables d'extraire l'objet\xa0JSON\xa0de la demande.\nIl nous faudra le package\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"body-parser"),". Installez-le en tant que d\xe9pendance de production\xa0\xe0 l'aide de\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"npm"),"\xa0:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-sh"},"npm install --save body-parser\n")),(0,t.mdx)("p",null,"Importez-le dans votre fichier\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"app.js"),"\xa0:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"const bodyParser = require('body-parser');\n")),(0,t.mdx)("p",null,"Enfin, d\xe9finissez sa fonction\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"json"),"\xa0comme\xa0",(0,t.mdx)("em",{parentName:"p"},"middleware")," global pour votre application, juste apr\xe8s avoir d\xe9fini les\xa0headers de la\nr\xe9ponse :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"app.use(bodyParser.json());\n")),(0,t.mdx)("p",null,"Maintenant,\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"body-parser"),"\xa0a analys\xe9 le corps de la demande. Au lieu de l'\xe9crire dans un ",(0,t.mdx)("em",{parentName:"p"},"middleware")," ",(0,t.mdx)("inlineCode",{parentName:"p"},".use()"),"\xa0qui traiterait toutes\nles requ\xeates, nous allons l'\xe9crire dans un ",(0,t.mdx)("inlineCode",{parentName:"p"},".post()"),"\xa0qui ne traitera que les requ\xeates de type POST :"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-javascript"},"app.post('/api/stuff', (req, res, next) => {\n    console.log(req.body);\n    res.status(201).json({\n        message: 'Objet cr\xe9\xe9 !'\n    });\n});\n")),(0,t.mdx)("div",{className:"admonition admonition-caution alert alert--warning"},(0,t.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,t.mdx)("h5",{parentName:"div"},(0,t.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,t.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,t.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"!")),(0,t.mdx)("div",{parentName:"div",className:"admonition-content"},(0,t.mdx)("p",{parentName:"div"},"Veillez \xe0 placer la route\xa0POST\xa0au-dessus du ",(0,t.mdx)("em",{parentName:"p"},"middleware")," pour les demandes GET,\xa0car la logique GET interceptera actuellement toutes\nles demandes envoy\xe9es \xe0 votre point de terminaison\xa0",(0,t.mdx)("inlineCode",{parentName:"p"},"/api/stuff"),", \xe9tant donn\xe9 qu'on ne lui a pas sp\xe9cifi\xe9 de verbe sp\xe9cifique. Placer\nla route POST\xa0au-dessus interceptera les demandes POST,\xa0en les emp\xeachant d'atteindre le ",(0,t.mdx)("em",{parentName:"p"},"middleware")," GET."))),(0,t.mdx)("p",null,"D\xe9sormais,\xa0si vous remplissez le formulaire dans l'application front-end et que vous l'envoyez, l'objet que vous venez de cr\xe9er doit\ns'enregistrer dans votre console Node !"),(0,t.mdx)("h3",{id:"en-r\xe9sum\xe9"},"En r\xe9sum\xe9"),(0,t.mdx)("p",null,"Dans cette premi\xe8re partie du cours, vous avez :"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},"configur\xe9 votre environnement de d\xe9veloppement, avec toutes les d\xe9pendances requises pour d\xe9marrer ;"),(0,t.mdx)("li",{parentName:"ul"},"d\xe9marr\xe9 votre premier serveur\xa0Node et l'avez utilis\xe9 pour g\xe9rer votre premi\xe8re application Express\xa0;"),(0,t.mdx)("li",{parentName:"ul"},"cr\xe9\xe9 deux routes\xa0pour votre application, et vous avez \xe9galement impl\xe9ment\xe9\xa0CORS\xa0pour vous assurer que le front-end pouvait\neffectuer des appels vers votre application en toute s\xe9curit\xe9.")),(0,t.mdx)("p",null,"Dans la partie suivante du cours, vous ajouterez la couche de base de donn\xe9es MongoDB. Celle-ci est essentielle pour votre\napplication\xa0et permettra de la rendre enti\xe8rement dynamique."),(0,t.mdx)("hr",null),(0,t.mdx)("h2",{id:"quiz--\xeates-vous-pr\xeat-\xe0-cr\xe9er-un-serveur-express-"},"Quiz : \xcates-vous pr\xeat \xe0 cr\xe9er un serveur Express ?"),(0,t.mdx)("p",null,(0,t.mdx)("a",{parentName:"p",href:"https://openclassrooms.com/fr/courses/6390246-passez-au-full-stack-avec-node-js-express-et-mongodb/exercises/3690"},"\xcates-vous pr\xeat \xe0 cr\xe9er un serveur Express ? - OpenClassrooms")),(0,t.mdx)("h4",{id:"comp\xe9tences-\xe9valu\xe9es"},"Comp\xe9tences \xe9valu\xe9es"),(0,t.mdx)("i",{class:"bi bi-check2-circle"})," Cr\xe9er un serveur web simple avec Express",(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-1--en-cr\xe9ant-un-serveur-http-avec-node-on-utilise-la-fonction-createserver-on-peut-passer-une-fonction-\xe0-createserverqui-r\xe9agira-aux-requ\xeates-entrantes-quels-arguments-re\xe7oit-cette-fonction-pass\xe9e-"},"Question 1 : En cr\xe9ant un serveur HTTP avec Node, on utilise la fonction ",(0,t.mdx)("inlineCode",{parentName:"h4"},"createServer()"),". On peut passer une fonction \xe0 ",(0,t.mdx)("inlineCode",{parentName:"h4"},"createServer()"),"\xa0qui r\xe9agira aux requ\xeates entrantes. Quels arguments re\xe7oit cette fonction pass\xe9e ?"),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Attention, plusieurs r\xe9ponses sont possibles.")),(0,t.mdx)("i",{class:"bi bi-check-square-fill"})," L'objet requ\xeate",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-check-square-fill"})," L'objet r\xe9ponse",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-square"})," La fonction ",(0,t.mdx)("code",null,"next()"),(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-square"})," La variable environnement ",(0,t.mdx)("code",null,"PORT"),(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"La fonction pass\xe9e en argument \xe0 ",(0,t.mdx)("inlineCode",{parentName:"em"},"createServer()"),"\xa0recevra les objets requ\xeate et r\xe9ponse comme arguments, g\xe9n\xe9ralement raccourcis en\n",(0,t.mdx)("inlineCode",{parentName:"em"},"req"),"\xa0et ",(0,t.mdx)("inlineCode",{parentName:"em"},"res"),". La fonction ",(0,t.mdx)("inlineCode",{parentName:"em"},"next()"),"\xa0existe uniquement \xe0 l'int\xe9rieur d'une application Express, et la fonction pass\xe9e ne re\xe7oit pas\nde variables environnement comme arguments.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-2--dans-une-application-express-que-doit-faire-le-dernier-middleware-pour-une-route-donn\xe9e-pour-emp\xeacher-les-requ\xeates-dexpirer-"},"Question 2 : Dans une application Express, que doit faire le dernier middleware pour une route donn\xe9e pour emp\xeacher les requ\xeates d'expirer ?"),(0,t.mdx)("i",{class:"bi bi-circle"})," Modifier le statut de l'objet r\xe9ponse",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Renvoyer la r\xe9ponse au client",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Modifier les headers de l'objet r\xe9ponse",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Appeler la fonction ",(0,t.mdx)("code",null,"next()"),(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Le dernier middleware d'une cha\xeene doit renvoyer la r\xe9ponse au client pour emp\xeacher la requ\xeate d'expirer.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-3--\xe0-quoi-sert-la-fonction-next"},"Question 3 : \xc0 quoi sert la fonction ",(0,t.mdx)("inlineCode",{parentName:"h4"},"next()"),"\xa0?"),(0,t.mdx)("i",{class:"bi bi-circle"})," Elle renvoie la r\xe9ponse au client",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Elle emp\xeache les erreurs CORS",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Elle passe l'ex\xe9cution au prochain middleware de la cha\xeene",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Elle analyse le corps de la requ\xeate",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Un middleware appelle la fonction ",(0,t.mdx)("inlineCode",{parentName:"em"},"next()"),"\xa0pour passer l'ex\xe9cution au prochain middleware de la cha\xeene.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-4--un-code-http-de-200repr\xe9senteg\xe9n\xe9ralement-"},"Question 4 : Un code HTTP de 200\xa0repr\xe9sente\xa0g\xe9n\xe9ralement :"),(0,t.mdx)("i",{class:"bi bi-circle"})," Une erreur serveur",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Une requ\xeate r\xe9ussie",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Une cr\xe9ation de donn\xe9es r\xe9ussie",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Une erreur d'authentification",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Un code HTTP de 200 est le code standard pour une requ\xeate r\xe9ussie, surtout pour des requ\xeates GET.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-5--un-code-http-de-201-repr\xe9sente-g\xe9n\xe9ralement-"},"Question 5 : Un code HTTP de 201 repr\xe9sente g\xe9n\xe9ralement :"),(0,t.mdx)("i",{class:"bi bi-circle"})," Une erreur serveur",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Une requ\xeate r\xe9ussie",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Une cr\xe9ation de donn\xe9es r\xe9ussie",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Une erreur d'authentification",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Un code 201 signifie g\xe9n\xe9ralement que la requ\xeate a r\xe9ussi, et a caus\xe9 la cr\xe9ation d'une nouvelle ressource.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-6--une-erreur-cors-peut-survenir-quand-"},"Question 6 : Une erreur CORS peut survenir quand :"),(0,t.mdx)("i",{class:"bi bi-circle"})," Une requ\xeate HTTP expire",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Le serveur r\xe9pond avec une erreur inconnue",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," La connexion est perdue pendant un transfert de donn\xe9es",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Le serveur et le client ne partagent pas la m\xeame origine",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"La s\xe9curit\xe9 CORS est une mesure de s\xe9curit\xe9 par d\xe9faut pour emp\xeacher l'utilisation de ressources par des origines non-autoris\xe9es.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-7--quelle-m\xe9thode-permet-demp\xeacher-des-erreurs-cors-"},"Question 7 : Quelle m\xe9thode permet d'emp\xeacher des erreurs CORS ?"),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Configurer des headers sp\xe9cifiques sur l'objet r\xe9ponse",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Configurer des headers sp\xe9cifiques sur l'objet requ\xeate",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Utiliser le bon code HTTP",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Envoyer la r\xe9ponse en format JSON",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Configurer les bons headers sur l'objet r\xe9ponse permet l'envoi et la r\xe9ception de requ\xeates et de r\xe9ponses sans erreurs CORS.")),(0,t.mdx)("hr",null),(0,t.mdx)("h4",{id:"question-8--le-package-body-parser"},"Question 8 : Le package ",(0,t.mdx)("inlineCode",{parentName:"h4"},"body-parser"),"\xa0:"),(0,t.mdx)("i",{class:"bi bi-circle"})," Permet d'\xe9viter les erreurs CORS",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Permet la persistance de donn\xe9es",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-record-circle"})," Rend les donn\xe9es du corps de la requ\xeate exploitable",(0,t.mdx)("br",null),(0,t.mdx)("i",{class:"bi bi-circle"})," Convertit les donn\xe9es de l'objet r\xe9ponse en JSON",(0,t.mdx)("br",null),(0,t.mdx)("br",null),(0,t.mdx)("p",null,(0,t.mdx)("em",{parentName:"p"},"Quand une requ\xeate HTTP est re\xe7ue par le serveur, son corps est rarement sous forme utile. Le package body-parser analyse le corps\nde la requ\xeate et le formate pour en faciliter l'exploitation.")))}c.isMDXComponent=!0}}]);
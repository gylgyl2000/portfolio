<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/Mon_Web_Dev_Wiki/blog/rss.xml" title="Mon wiki de développement web RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Mon_Web_Dev_Wiki/blog/atom.xml" title="Mon wiki de développement web Atom Feed"><title data-react-helmet="true">Parallélisez vos longues tâches avec la programmation asynchrone | Mon wiki de développement web</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://gylgyl2000.github.io/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Parallélisez vos longues tâches avec la programmation asynchrone | Mon wiki de développement web"><meta data-react-helmet="true" name="description" content="Comprenez comment fonctionne l&#x27;asynchrone en JS"><meta data-react-helmet="true" property="og:description" content="Comprenez comment fonctionne l&#x27;asynchrone en JS"><link data-react-helmet="true" rel="icon" href="https://monwikidevweb.la-loutre.fr/img/river-otter-silhouette.svg"><link data-react-helmet="true" rel="canonical" href="https://gylgyl2000.github.io/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone"><link data-react-helmet="true" rel="alternate" href="https://gylgyl2000.github.io/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://gylgyl2000.github.io/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone" hreflang="x-default"><link rel="stylesheet" href="/Mon_Web_Dev_Wiki/assets/css/styles.7fa1ce1f.css">
<link rel="preload" href="/Mon_Web_Dev_Wiki/assets/js/runtime~main.d0ff12ed.js" as="script">
<link rel="preload" href="/Mon_Web_Dev_Wiki/assets/js/main.ebe36446.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Mon_Web_Dev_Wiki/"><div class="navbar__logo"><img src="https://monwikidevweb.la-loutre.fr/img/river-otter-silhouette.svg" alt="Otter" class="themedImage_W2Cr themedImage--light_TfLj"><img src="https://monwikidevweb.la-loutre.fr/img/river-otter-silhouette.svg" alt="Otter" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Mon Wiki Dev Web par LaLoutre</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Mon_Web_Dev_Wiki/docs/menu">Menu</a><a class="navbar__item navbar__link" href="/Mon_Web_Dev_Wiki/docs/Outils/menu">Outils</a><a class="navbar__item navbar__link" href="/Mon_Web_Dev_Wiki/docs/Aide-memoire/menu">Aide-mémoire</a><a class="navbar__item navbar__link" href="/Mon_Web_Dev_Wiki/docs/Algorithmes/menu">Algorithmes</a><a class="navbar__item navbar__link" href="/Mon_Web_Dev_Wiki/docs/Lexique/">Lexique</a><a href="https://github.com/gylgyl2000/Mon_Web_Dev_Wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/menu">OpenClassrooms</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Prenez_en_main_votre_formation_de_developpeur_web/mission">Prenez en main votre formation de développeur web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Transformez_une_maquette_en_site_web_avec_HTML_&amp;_CSS/mission">Transformez une maquette en site web avec HTML &amp; CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Dynamisez_une_page_web_avec_des_animations_CSS/mission">Dynamisez une page web avec des animations CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Optimisez_un_site_web_existant/mission">Optimisez un site web existant</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/ancienne_mission">Construisez un site e-commerce</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/ancienne_mission">Ancienne mission</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/mission">Mission</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Decouvrez_le_fonctionnement_des_algorithmes/Introduction_du_cours">Découvrez le fonctionnement des algorithmes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Apprenez_a_programmer_avec_JavaScript/Introduction_du_cours">Apprenez à programmer avec JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/Introduction_du_cours">Écrivez du JavaScript pour le web</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/Introduction_du_cours">Introduction du cours</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/1-Manipulez_le_DOM">Manipulez le DOM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/2-Communiquez_via_une_API_avec_un_service_web">Communiquez via une API avec un service web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone">Parallélisez vos longues tâches avec la programmation asynchrone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/4-Mettez_en_place_les_bons_outils_pour_travailler">Mettez en place les bons outils pour travailler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Deboguez_l_interface_de_votre_site_internet/Introduction_du_cours">Déboguez l’interface de votre site internet</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_une_API_securisee_pour_une_application_d_avis_gastronomiques/mission">Construisez une API sécurisée pour une application d&#x27;avis gastronomiques</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Creez_un_reseau_social_d_entreprise/mission">Créez un réseau social d’entreprise</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Definissez_votre_projet_professionnel_et_preparez_vos_outils_de_candidature/mission">Définissez votre projet professionnel et préparez vos outils de candidature</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Candidatez/mission">Candidatez</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Parallélisez vos longues tâches avec la programmation asynchrone</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="comprenez-comment-fonctionne-lasynchrone-en-js">Comprenez comment fonctionne l&#x27;asynchrone en JS<a class="hash-link" href="#comprenez-comment-fonctionne-lasynchrone-en-js" title="Direct link to heading">​</a></h2><p><a href="https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577651-comprenez-comment-fonctionne-lasynchrone-en-js" target="_blank" rel="noopener noreferrer">Comprenez comment fonctionne l&#x27;asynchrone en JS - Écrivez du JavaScript pour le web - OpenClassrooms</a></p><div data-testid="general-observer" class="mdx-embed"><div style="height:0;width:100%"></div></div><br><p>Saviez-vous que JavaScript est synchrone et n&#x27;a qu&#x27;un seul <em>thread</em> d&#x27;exécution ?</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>?</h5></div><div class="admonition-content"><p>... qu&#x27;est-ce que tu nous racontes là ?</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-est-synchrone-et-mono-thread">JavaScript est synchrone et mono-thread<a class="hash-link" href="#javascript-est-synchrone-et-mono-thread" title="Direct link to heading">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>?</h5></div><div class="admonition-content"><p>Qu&#x27;est-ce que ça veut dire ?</p></div></div><p>Eh bien, tout simplement qu&#x27;il n&#x27;y a qu&#x27;<strong>un seul fil d&#x27;exécution</strong> du code source. Cela signifie que lorsque vous écrivez du code, chaque
ligne sera exécutée <strong>l&#x27;une après l&#x27;autre</strong> en attendant la fin de l&#x27;exécution de la ligne précédente. Il n&#x27;y a pas d&#x27;autre code qui pourra
être exécuté en parallèle. Il ne peut faire qu&#x27;une seule chose à la fois.</p><p>Mais dans le titre du chapitre tu parles de faire de l&#x27;asynchrone en JavaScript, et là tu nous dis que ce n&#x27;est plus possible ?</p><p>Eh bien, en fait il est possible et même très facile de faire de l&#x27;asynchrone en JavaScript, mais l&#x27;exécution restera synchrone...</p><p>🧐</p><p>Bon, essayons de clarifier tout ça maintenant...</p><p>Si du code <strong>synchrone</strong> est du code qui s&#x27;exécute ligne après ligne en attendant la <strong>fin de l&#x27;exécution</strong> de la ligne précédente, alors on
peut facilement en déduire que du code <strong>asynchrone</strong> va s&#x27;exécuter ligne après ligne, mais la ligne suivante <strong>n&#x27;attendra pas</strong> que la ligne
asynchrone ait fini son exécution. Prenons cet exemple :</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> productId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> productPrice </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getProductPriceAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">doSomething</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">productPrice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>En admettant que la fonction <code>getProductPriceAsync()</code> soit asynchrone, alors la ligne suivante sera exécutée avant la fin de l&#x27;exécution de la
fonction asynchrone, mais il ne sera pas encore possible d&#x27;utiliser la valeur de <code>productPrice</code> (nous verrons dans le chapitre suivant comment
nous pouvons nous en servir).</p><p>Mais comment peut-on faire ça avec un langage synchrone ?</p><p>Avec ce qu&#x27;on appelle l&#x27;<em>event loop</em> !</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="levent-loop">L&#x27;event loop<a class="hash-link" href="#levent-loop" title="Direct link to heading">​</a></h3><p>En JavaScript, chaque ligne de code est exécutée de façon synchrone, mais il est possible de demander à exécuter du code de manière asynchrone.
Et lorsque l&#x27;on demande à exécuter une fonction de façon asynchrone, la fonction en question est placée dans une sorte de <strong>file d&#x27;attente</strong>
qui va exécuter toutes les fonctions qu&#x27;elle contient les unes après les autres. C&#x27;est ce qu&#x27;on appelle l&#x27;<em><strong>event loop</strong>.</em> Tout le cœur du
langage fonctionne autour de ça.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Ainsi, le code n&#x27;est pas réellement exécuté en parallèle car il est mis en file d&#x27;attente, mais il ne bloque pas l&#x27;exécution du code depuis
lequel il a été appelé.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="jouez-avec-levent-loop">Jouez avec l&#x27;event loop<a class="hash-link" href="#jouez-avec-levent-loop" title="Direct link to heading">​</a></h3><p>Maintenant que vous comprenez un peu mieux ce qu&#x27;est l&#x27;event loop, voyons concrètement comment demander à exécuter du code de manière asynchrone.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="la-fonction-settimeout">La fonction setTimeout<a class="hash-link" href="#la-fonction-settimeout" title="Direct link to heading">​</a></h4><p><code>setTimeout</code> est la fonction <strong>la plus répandue</strong> lorsque l&#x27;on veut exécuter du code asynchrone sans bloquer le fil d&#x27;exécution en cours. Cette
fonction prend 2 paramètres :</p><ul><li>La <strong>fonction à exécuter</strong> de manière asynchrone (qui sera donc ajoutée à la file d&#x27;attente de l&#x27;event loop) ;</li><li>Le <strong>délai</strong>, en millisecondes, avant d&#x27;exécuter cette fonction.</li></ul><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;I&#x27;m here!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Where are you?&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Dans l&#x27;exemple ci-dessus, le texte <code>Where are you?</code> s&#x27;affichera avant <code>I&#x27;m here!</code>, qui ne sera affiché qu&#x27;au bout de 5 secondes.</p><p>La fonction <code>setTimeout</code> nous retourne une valeur permettant d&#x27;identifier le code asynchrone que l&#x27;on veut exécuter. Il est possible de passer
cet identifiant en paramètre à la fonction <code>clearTimeout</code>, si vous souhaitez annuler l&#x27;exécution asynchrone de la fonction avant qu&#x27;elle ne
soit exécutée.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Pour en savoir plus sur la fonction setTimeout, vous trouverez la documentation <a href="https://www.w3schools.com/jsref/met_win_settimeout.asp" target="_blank" rel="noopener noreferrer">ici, sur le site de W3school</a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="les-autres-méthodes">Les autres méthodes<a class="hash-link" href="#les-autres-méthodes" title="Direct link to heading">​</a></h4><p>Il existe d&#x27;autres méthodes un peu moins répandues, voire très peu utilisées :</p><ul><li><code>setInterval</code> (<a href="https://www.w3schools.com/jsref/met_win_setinterval.asp" target="_blank" rel="noopener noreferrer">documentation à retrouver ici</a>) : elle fonctionne exactement comme
<code>setTimeout</code>, à ceci près qu&#x27;elle exécute la fonction passée en paramètre <strong>en boucle</strong> à une <strong>fréquence déterminée</strong> par le temps en
millisecondes passé en second paramètre. Il suffira de passer la valeur de retour de <code>setInterval</code> à <code>clearInterval</code> pour <strong>stopper</strong>
l&#x27;exécution en boucle de la fonction ;</li><li><code>setImmediate</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/setImmediate" target="_blank" rel="noopener noreferrer">documentation à retrouver ici</a>). Cette fonction prend
en seul paramètre la fonction à exécuter de façon synchrone.  La fonction en question sera placée dans la <strong>file d&#x27;attente</strong> de l&#x27;event loop,
mais va <strong>passer devant</strong> toutes les autres fonctions, sauf certaines spécifiques au Javascript : les événements (les mêmes qu&#x27;on a vus au
premier chapitre, et qui sont donc exécutés de façon asynchrone 😉), le rendu, et l&#x27;I/O. Il existe aussi <code>nextTick</code>, qui permet, là, de
court-circuiter tout le monde. À utiliser avec précaution, donc...</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="le-cas-de-lio">Le cas de l&#x27;I/O<a class="hash-link" href="#le-cas-de-lio" title="Direct link to heading">​</a></h3><p>L&#x27;I/O correspond aux événements liés à l&#x27;<em><strong>input</strong></em>(les flux d&#x27;entrée) et l&#x27;<em><strong>output</strong></em>(les flux de sortie). Cela correspond notamment à la
lecture/écriture des fichiers, aux requêtes HTTP, etc.</p><p>Vous avez dû remarquer que lorsque l&#x27;on exécutait la fonction <code>fetch()</code> lors d&#x27;une requête HTTP, celle-ci ne bloquait pas l&#x27;exécution du code.
On n&#x27;attend pas que la requête soit envoyée et une réponse reçue avant d&#x27;exécuter le reste du code. C&#x27;est donc une <strong>fonction asynchrone</strong>.</p><p>D’ailleurs, <em><code>fetch()</code></em> retourne une <em>Promise</em> qui est une autre façon de faire de l’asynchrone car les fonctions <em><code>then()</code></em> et <em><code>catch()</code></em> sont
appelées plus tard lorsque le travail (dans ce qu’on a vu dans le chapitre précédent il s’agissait d’une requête HTTP) est terminé. Et de la
même manière, tout ce qui touche à l&#x27;I/O peut être exécuté de manière asynchrone. Et c&#x27;est tant mieux, car leur exécution peut prendre du temps. 😎</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="en-résumé">En résumé<a class="hash-link" href="#en-résumé" title="Direct link to heading">​</a></h3><p>Dans ce chapitre, vous avez appris :</p><ul><li>Que le JavaScript est synchrone et mono-thread ;</li><li>Que l’event loop est le moteur de JavaScript qui exécute les fonctions JavaScript asynchrones sous forme d’événements ;</li><li>Comment utiliser la méthode  setTimeout ;</li><li>Qu&#x27;il existe d&#x27;autres méthodes asynchrones : <em>setInterval</em>, <em>setImmediate</em> ;</li><li>Que l&#x27;I/O est géré de manière asynchrone avec JavaScript.</li></ul><p>Vous savez maintenant comment exécuter du code de manière asynchrone, mais on ne sait pas comment profiter du résultat de ce code depuis celui
qui l&#x27;a exécuté.</p><p><em>Vous vous rappelez de notre exemple de code avec la fonction <code>getProductPriceAsync</code> ? Eh bien, avec ce que nous venons d&#x27;apprendre nous ne
sommes pas en mesure de renvoyer le résultat de notre code dans la variable <code>productPrice</code>. Et c&#x27;est justement dans le prochain chapitre que
nous allons voir ça !</em></p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="gérez-du-code-asynchrone">Gérez du code asynchrone<a class="hash-link" href="#gérez-du-code-asynchrone" title="Direct link to heading">​</a></h2><p><a href="https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5577676-gerez-du-code-asynchrone" target="_blank" rel="noopener noreferrer">Gérez du code asynchrone - Écrivez du JavaScript pour le web - OpenClassrooms</a></p><div data-testid="general-observer" class="mdx-embed"><div style="height:0;width:100%"></div></div><br><p>Nous allons maintenant voir comment on peut exécuter du code asynchrone et renvoyer le résultat que l&#x27;on souhaite à celui qui a lancé le code.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="callbacks">Callbacks<a class="hash-link" href="#callbacks" title="Direct link to heading">​</a></h3><p>C&#x27;est la méthode la plus &quot;vieille&quot; mais toujours utilisée par beaucoup de modules JavaScript (nous verrons ce que sont les modules dans la
dernière partie de ce cours). Une <em><strong>callback</strong></em> est simplement une fonction que vous définissez. Le principe de la callback est de la
<strong>passer en paramètre</strong> d&#x27;une fonction asynchrone. Une fois que la fonction asynchrone a fini sa tâche, elle va appeler notre fonction
<em>callback</em> en lui passant un <strong>résultat</strong>. Ainsi, le code que nous mettons dans notre fonction <em>callback</em> sera exécuté de manière asynchrone.
Cela ne vous rappelle pas quelque chose ? Les <strong>événements</strong> ! Les événements sont un exemple typique de fonction asynchrone à laquelle on
passe une fonction <em>callback</em>.</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something here ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Dans l&#x27;exemple ci-dessus, la fonction qui est envoyée à <code>addEventListener</code> est une callback. Elle n&#x27;est pas appelée tout de suite, elle est
appelée plus tard, dès que l&#x27;utilisateur clique sur l&#x27;élément. Ça ne bloque donc pas l&#x27;exécution du code et c&#x27;est donc asynchrone. 😁</p><p>Les callbacks sont la <strong>base de l&#x27;asynchrone</strong> en JavaScript et sont très utilisées.</p><blockquote><p>Par exemple, la fonction que nous passons en paramètre à <code>setTimeout</code> est une callback.</p></blockquote><p>Les callbacks sont faciles à comprendre et à utiliser, mais elles souffrent d&#x27;un gros problème de lisibilité du code, via ce qu&#x27;on appelle le
<em>callback hell</em>. En effet, on se retrouve régulièrement dans des situations où on va imbriquer plusieurs couches de callbacks, rendant le code
difficile à lire et pouvant générer des erreurs.</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">elt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ce code, qui n&#x27;est pas facile à lire, pourrait pourtant correspondre à un cas d&#x27;utilisation concret des callbacks : dès que l&#x27;utilisateur
clique sur un élément, on ouvre une connexion <em>MySQL</em>, puis on récupère des données depuis la base de données, on lit un contenu dans un
fichier et on fait une nouvelle requête <em>MySQL</em>, etc.</p><p>C&#x27;est bien beau de gérer du code asynchrone, mais rien ne vous garantit que tout se soit bien passé. Il nous faut donc un mécanisme pour savoir
si une erreur est survenue !</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="gérezdes-erreurs-callbacks">Gérez des erreurs callbacks<a class="hash-link" href="#gérezdes-erreurs-callbacks" title="Direct link to heading">​</a></h4><p>Pour gérer les erreurs avec les callbacks, la méthode la plus utilisée est de prendre <strong>2 paramètres</strong> dans notre callback. Le 2e paramètre
est notre donnée et le 1er est l&#x27;erreur. Si elle n&#x27;est pas <em><strong>null</strong></em> ou <em><strong>undefined</strong></em>,  elle contiendra un message d&#x27;erreur indiquant qu&#x27;une
erreur est intervenue.</p><p>Si on reprend l&#x27;exemple ci-dessus, on voit par exemple que la lecture d&#x27;un fichier avec le module <code>fs</code> peut nous retourner une erreur :</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">readFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Do something with data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="promise">Promise<a class="hash-link" href="#promise" title="Direct link to heading">​</a></h3><p>Les <em><strong>promise</strong></em>, ou <em>promesses</em> en français, sont un peu plus complexes mais bien plus puissantes et faciles à lire que les callbacks.</p><p>Lorsque l&#x27;on exécute du code asynchrone, celui-ci va immédiatement nous retourner une &quot;promesse&quot; qu&#x27;un résultat nous sera envoyé prochainement.</p><p>Cette promesse est en fait un objet <code>Promise</code> qui peut être <code>resolve</code> avec un résultat, ou <code>reject</code> avec une erreur.</p><p>Lorsque l&#x27;on récupère une <code>Promise</code>, on peut utiliser sa fonction <code>then()</code> pour exécuter du code dès que la promesse est résolue, et sa fonction
<code>catch()</code> pour exécuter du code dès qu&#x27;une erreur est survenue.</p><p>Voyons avec un exemple concret pour mieux comprendre :</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">functionThatReturnsAPromise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Do something with data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Do something with error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Dans l&#x27;exemple ci-dessus, la fonction <code>functionThatReturnsAPromise</code> nous renvoie une <code>Promise</code>. On peut donc utiliser sa fonction <code>then()</code> en
lui passant une fonction qui sera exécutée dès qu&#x27;un résultat sera reçu (avec le résultat en question passé à notre fonction). On peut aussi
utiliser sa fonction <code>catch()</code> en lui passant une fonction qui sera exécutée si une erreur est survenue (avec l&#x27;erreur en question passée à
notre fonction).</p><p>Le gros avantage est que l&#x27;on peut aussi <strong>chaîner</strong> les <code>Promise</code>. Ainsi, la valeur que l&#x27;on retourne dans la fonction que l&#x27;on passe à
<code>then()</code> est transformée en une nouvelle <code>Promise</code> résolue, que l&#x27;on peut utiliser avec une nouvelle fonction <code>then()</code>. Si notre fonction
retourne par contre une exception, alors une nouvelle <code>Promise</code> rejetée est créée et on peut l&#x27;intercepter avec la fonction <code>catch()</code>. Mais si
la fonction que l&#x27;on a passée à <code>catch()</code> retourne une nouvelle valeur, alors on a à nouveau une <code>Promise</code> résolue que l&#x27;on peut utiliser avec
une fonction <code>then()</code>, etc.</p><p>Voici un exemple qui vous montre comment on peut profiter des <code>Promise</code> pour chaîner notre code asynchrone :</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">returnAPromiseWithNumber2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Data is 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Data is 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Not executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Data is 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Dans l&#x27;exemple ci-dessus, la fonction <code>returnAPromiseWithNumber2</code> nous renvoie une <code>Promise</code> qui va être résolue avec le nombre <code>2</code>.</p><ul><li>La première fonction <code>then()</code> va récupérer cette valeur.</li><li>Puis, dans cette fonction on retourne <code>2 + 1</code>, ce qui crée une nouvelle <code>Promise</code> qui est immédiatement résolue avec <code>3</code>.</li><li>Puis, dans le <code>then()</code> suivant, nous retournons une erreur.</li></ul><p>De ce fait, le <code>then()</code> qui suit ne sera pas appelé et c&#x27;est le <code>catch()</code> suivant qui va être appelé avec l&#x27;erreur en question. Lui-même
retourne une nouvelle valeur qui est transformée en Promise qui est immédiatement résolue avec la valeur <code>5</code>. Le dernier <code>then()</code> va être
exécuté avec cette valeur.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>L’API <code>Fetch</code> utilise les <code>Promise</code> pour gérer les réponses aux requêtes HTTP, comme nous l’avons vu dans la partie précédente.</p></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="gérez-deserreurs-promise">Gérez des erreurs Promise<a class="hash-link" href="#gérez-deserreurs-promise" title="Direct link to heading">​</a></h4><p>Nous avons déjà vu comment se gèrent les erreurs avec les <code>Promise</code>. Une erreur correspond à une <strong>exception</strong> qui a été lancée, et il est
possible de l&#x27;intercepter en appelant la fonction <code>catch()</code> de la <code>Promise</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="asyncawait">Async/await<a class="hash-link" href="#asyncawait" title="Direct link to heading">​</a></h3><p><code>async</code> et <code>await</code> sont 2 nouveaux mots clés qui permettent de gérer le code asynchrone de manière beaucoup plus intuitive, en bloquant
l&#x27;exécution d&#x27;un code asynchrone jusqu&#x27;à ce qu&#x27;il retourne un résultat.</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fonctionAsynchrone1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token comment" style="color:#999988;font-style:italic">/* code asynchrone */</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fonctionAsynchrone2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token comment" style="color:#999988;font-style:italic">/* code asynchrone */</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fonctionAsynchrone3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> value1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fonctionAsynchrone1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> value2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fonctionAsynchrone2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> value1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> value2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Dans cet exemple, nous avons un total de 3 fonction asynchrones : <code>fonctionAsynchrone1</code>, <code>fonctionAsynchrone2</code>, <code>fonctionAsynchrone3</code>. Quand
on utilise <code>async</code> et <code>await</code>, une fonction asynchrone doit avoir le mot clé <code>async</code> avant la fonction. Ensuite, dans le code, nous pouvons
faire appel à des fonctions asynchrones et attendre leur résultat grâce au mot clé <code>await</code> que l&#x27;on met devant l&#x27;appel de la fonction.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>!</h5></div><div class="admonition-content"><p><code>async</code> / <code>await</code> utilisent les Promise en arrière-plan, il est donc possible d&#x27;utiliser les 2 en même temps.</p></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="gérez-deserreurs-asyncawait">Gérez des erreurs async/await<a class="hash-link" href="#gérez-deserreurs-asyncawait" title="Direct link to heading">​</a></h4><p><code>async</code> / <code>await</code> utilisant les Promise, la levée d&#x27;une erreur se fait aussi par une <strong>exception</strong>.</p><p>Pour intercepter cette erreur, par contre, il suffit d&#x27;exécuter notre code asynchrone dans un bloc <code>try {} catch (e) {}</code>, l&#x27;erreur étant
envoyée dans le <code>catch</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="à-vous-de-jouer">À vous de jouer !<a class="hash-link" href="#à-vous-de-jouer" title="Direct link to heading">​</a></h3><p><img src="https://user.oc-static.com/upload/2021/04/20/16189267631776_A-vous-de-jouer%20%282%29.png" alt="16189267631776_A-vous-de-jouer%20%282%29.png"></p><p>Rendez-vous sur <a href="https://codepen.io/nicolaspatschkowski/pen/NWqyaKP" target="_blank" rel="noopener noreferrer">cet éditeur CodePen</a> pour réaliser l&#x27;exercice suivant.</p><p>Dans cet exercice j&#x27;ai créé 2 fonctions asynchrones (avec le mot clé <code>async</code>) <code>getNumber1()</code> et <code>getNumber2()</code>.</p><ol><li>Dans un premier temps nous allons créer une fonction asynchrone (avec <code>async</code>) qui s&#x27;appelle <code>compute</code> et qui va récupérer les résultats des
2 fonctions asynchrones <code>getNumber1()</code> et <code>getNumber2()</code> (avec <code>await</code>) et renvoyer la somme des 2 valeurs récupérées.</li><li>Maintenant nous allons appeler notre fonction <code>compute()</code> et utiliser sa valeur de retour comme une <code>Promise</code> pour finalement afficher le
résultat de la promesse dans le contenu HTML de l&#x27;élément ayant pour ID <code>result</code>.</li></ol><div data-testid="general-observer" class="mdx-embed"><div style="height:500px;width:100%"></div></div><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNumber1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNumber2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> number1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNumber1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> number2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNumber2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> number1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> number2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">compute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerText</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Vous avez terminé ? Voici la <a href="https://codepen.io/fabienhenon/pen/XWNGgvd" target="_blank" rel="noopener noreferrer">solution CodePen</a>.</p><div data-testid="general-observer" class="mdx-embed"><div style="height:500px;width:100%"></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="en-résumé-1">En résumé<a class="hash-link" href="#en-résumé-1" title="Direct link to heading">​</a></h3><p>Dans ce chapitre, vous avez appris :</p><ul><li>Qu&#x27;une callback est une fonction appelée &quot;plus tard&quot; ;</li><li>Que les <code>Promise</code> sont des objets qui nous fournissent les fonctions <em><code>then()</code></em> et <em><code>catch()</code></em> pour gérer le code asynchrone ;</li><li>Que <code>async</code> et <code>await</code> permettent de faire de l’asynchrone avec une syntaxes plus naturelle, et qu’ils utilisent en arrière plan les
<em>Promise.</em></li></ul><p><em>Nous connaissons maintenant 3 techniques pour faire du code asynchrone et pouvoir utiliser sa valeur ; voyons maintenant comment ça peut nous
servir dans le cas de plusieurs requêtes HTTP !</em></p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="parallélisez-plusieurs-requêtes-http">Parallélisez plusieurs requêtes HTTP<a class="hash-link" href="#parallélisez-plusieurs-requêtes-http" title="Direct link to heading">​</a></h2><p><a href="https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/5866911-parallelisez-plusieurs-requetes-http" target="_blank" rel="noopener noreferrer">Parallélisez plusieurs requêtes HTTP - Écrivez du JavaScript pour le web - OpenClassrooms</a></p><div data-testid="general-observer" class="mdx-embed"><div style="height:0;width:100%"></div></div><br><p>Dans ce chapitre, nous allons voir comment <strong>enchaîner</strong> les requêtes HTTP en exécutant 2 requêtes GET en même temps (en parallèle), puis 1
requête POST une fois que les 2 requêtes précédentes sont terminées (en séquence). Pour cela, nous allons avoir besoin des techniques
asynchrones vues au chapitre précédent.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="enchaînez-des-requêtes-avec-les-callbacks">Enchaînez des requêtes avec les callbacks<a class="hash-link" href="#enchaînez-des-requêtes-avec-les-callbacks" title="Direct link to heading">​</a></h3><p>Voyons ensemble comment faire nos 2 requêtes <strong>en parallèle</strong>, suivies d&#x27;une requête <strong>en séquence</strong> avec les callbacks. Et vous verrez, ça
peut vite devenir complexe !</p><blockquote><p>Pour cet exemple, nous partons du principe que nous avons accès à 2 fonctions (<code>get</code> et <code>post</code>). Elles font respectivement une requête <code>GET</code>
et une requête <code>POST</code> et elles prennent en paramètre :</p><ul><li>l&#x27;URL de la requête,</li><li>une callback à exécuter quand on a le résultat (avec une variable d&#x27;erreur en premier paramètre).</li></ul></blockquote><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">GETRequestCount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">GETRequestResults</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">onGETRequestDone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">GETRequestCount</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">GETRequestResults</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">GETRequestCount</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// We are done here !</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onGETRequestDone</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> onGETRequestDone</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Comme vous pouvez le voir, le code est assez particulier à lire. Il y a d&#x27;autres façons d&#x27;écrire ce code, mais ça reste une des façons les plus
simples et rapides à écrire.</p><p>Afin d&#x27;exécuter 2 requêtes <code>GET</code> en même temps, nous pouvons appeler 2 fois la fonction <code>get()</code>. Étant donné que cette fonction est
<strong>asynchrone</strong>, elle ne bloquera pas l&#x27;exécution du code. Ainsi l&#x27;autre fonction <code>get()</code> sera aussi appelée alors que la première ne sera pas
encore terminée. C&#x27;est comme ça qu&#x27;on peut avoir 2 requêtes en parallèle.</p><p>Par contre, nous voulons exécuter une requête <code>POST</code> une fois que les <strong>2 requêtes <code>GET</code> sont terminées</strong>, et pas avant ! Pour ce faire, nous
devons savoir si les requêtes <code>GET</code> sont terminées. C&#x27;est pour ça que la variable <code>GETRequestCount</code> est créée. On va l&#x27;<strong>incrémenter</strong> dans la
fonction <em>callback</em> que l&#x27;on a envoyée aux appels à <code>get()</code>, et si on atteint 2 (le nombre de requêtes <code>GET</code> qu&#x27;on a faites), alors on va
exécuter la requête <code>POST</code>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><code>GETRequestResults</code> sert à conserver les réponses des requêtes <code>GET</code>, car on ne les a pas toutes les 2 en même temps.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="enchaînez-des-requêtes-avec-les-promise">Enchaînez des requêtes avec les Promise<a class="hash-link" href="#enchaînez-des-requêtes-avec-les-promise" title="Direct link to heading">​</a></h3><p>Grâce à la fonction <code>Promise.all</code>, voyons comment exécuter nos requêtes en parallèle et en séquence avec les <code>Promise</code>.</p><blockquote><p>Pour cet exemple, nous partons du principe que nous avons accès à 2 fonctions (<code>get</code> et <code>post</code>) qui font respectivement une requête <code>GET</code> et
une requête <code>POST</code> quand on leur passe en paramètre l&#x27;URL de la requête. Ces fonctions retourneront une <code>Promise</code> avec le résultat de la
requête.</p></blockquote><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">results</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">results</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">allResults</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// We are done here !</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Ici, nous utilisons la fonction <code>Promise.all</code> qui prend en paramètre une liste de <code>Promise</code> (cela peut aussi être de simples valeurs qui sont
alors transformées en <code>Promise</code> résolues), et qui permet de toutes les exécuter en parallèle et de retourner une nouvelle <code>Promise</code> qui sera
résolue quand toutes les <code>Promise</code> seront résolues.</p><p>Ainsi, la fonction <code>then()</code> recevra les résultats de toutes les <code>Promise</code> sous forme d&#x27;un tableau.</p><p>Afin d&#x27;exécuter notre requête <code>POST</code> une fois que les requêtes <code>GET</code> sont terminées, nous l&#x27;exécutons donc dans la fonction <code>then()</code>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Notez que dans la fonction <code>then()</code>, nous faisons encore une fois appel à la fonction <code>Promise.all</code> en lui passant les résultats des requêtes
<code>GET</code> et notre requête <code>POST</code>. Étant donné que <code>Promise.all</code> considère les simples valeurs comme des <code>Promise</code> résolues, cela nous permet, dans
le prochain <code>then()</code>, de récupérer une liste qui contient les résultats des requêtes <code>GET</code> et le résultat de la requête <code>POST</code> :
<code>allResults = [ [ getResult1, getResult2 ], postResult ]</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="enchaînez-des-requêtes-avec-asyncawait">Enchaînez des requêtes avec async/await<a class="hash-link" href="#enchaînez-des-requêtes-avec-asyncawait" title="Direct link to heading">​</a></h3><p>Finalement, voyons comment exécuter le même code mais avec <code>async</code> / <code>await</code>.</p><blockquote><p>Pour cet exemple, nous partons du principe que nous avons accès à 2 fonctions (<code>get</code> et <code>post</code>) qui font respectivement une requête <code>GET</code> et
une requête <code>POST</code> quand on leur passe en paramètre l&#x27;URL de la requête. Ces fonctions sont asynchrones (avec le mot clé <code>async</code>).</p></blockquote><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">requests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> getResults </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> postResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">getResults</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> postResult\</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">requests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">allResults</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// We are done here !</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Nous utilisons aussi la fonction <code>Promise.all</code> dans ce code, car c&#x27;est comme ça que l&#x27;on peut exécuter des fonctions asynchrones en parallèle
(rappelez-vous que <code>async</code> correspond en arrière-plan à une <code>Promise</code>).</p><p>Par contre, ici, nous utilisons <code>await</code> devant <code>Promise.all</code> afin d&#x27;attendre la fin de l&#x27;exécution des 2 requêtes <code>GET</code>, puis nous utilisons
<code>await</code> devant la requête <code>POST</code> afin d&#x27;attendre son résultat. Puis nous renvoyons un tableau avec tous les résultats.</p><p>Lorsque nous appelons la fonction <code>requests()</code>, ici, nous utilisons <code>then()</code> pour récupérer tous les résultats (mais vous auriez aussi pu
utiliser <code>await</code> au sein d&#x27;une autre fonction avec le mot clé <code>async</code>).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="en-résumé-2">En résumé<a class="hash-link" href="#en-résumé-2" title="Direct link to heading">​</a></h3><p>Dans ce chapitre, vous avez appris :</p><ul><li>À enchaîner des requêtes avec la méthode des callbacks ;</li><li>À enchaîner des requêtes avec la méthode des <code>Promise</code> ;</li><li>À enchaîner des requêtes avec la méthode <code>async</code> / <code>await</code>.</li></ul><p><em>Vous connaissez maintenant 3 techniques pour exécuter du code asynchrone et vous savez les mettre en situation. À vous maintenant de vous
faire votre propre avis sur celle que vous préférez utiliser. Il est temps maintenant de passer à la prochaine partie où nous verrons comment
coder en JavaScript dans un environnement plus efficace.  😎</em></p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="quiz--parallélisez-vos-longues-tâches-avec-la-programmation-asynchrone">Quiz : Parallélisez vos longues tâches avec la programmation asynchrone<a class="hash-link" href="#quiz--parallélisez-vos-longues-tâches-avec-la-programmation-asynchrone" title="Direct link to heading">​</a></h2><p><a href="https://openclassrooms.com/fr/courses/5543061-ecrivez-du-javascript-pour-le-web/exercises/3197" target="_blank" rel="noopener noreferrer">Parallélisez vos longues tâches avec la programmation asynchrone - OpenClassrooms</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="compétences-évaluées">Compétences évaluées<a class="hash-link" href="#compétences-évaluées" title="Direct link to heading">​</a></h4><i class="bi bi-check2-circle"></i> Utiliser des méthodes asynchrones<hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-1--que-peut-on-dire-du-langage-javascript-">Question 1 : Que peut-on dire du langage JavaScript ?<a class="hash-link" href="#question-1--que-peut-on-dire-du-langage-javascript-" title="Direct link to heading">​</a></h4><i class="bi bi-circle"></i> Qu&#x27;il est asynchrone et mono-thread<br><i class="bi bi-record-circle"></i> Qu&#x27;il est synchrone et mono-thread<br><i class="bi bi-circle"></i> Qu&#x27;il est asynchrone et multi-thread<br><i class="bi bi-circle"></i> Qu&#x27;il est synchrone et multi-thread<br><br><p><em>Le JavaScript est un langage synchrone et mono-thread. L&#x27;asynchrone se fait grâce à l&#x27;event loop en envoyant des fonctions dans sa file
d&#x27;attente.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-2--quest-ce-que-levent-loop-">Question 2 : Qu&#x27;est-ce que l&#x27;event loop ?<a class="hash-link" href="#question-2--quest-ce-que-levent-loop-" title="Direct link to heading">​</a></h4><i class="bi bi-record-circle"></i> Un gros tunnel mono-thread dans lequel sont empilées des fonctions qui vont être exécutées les unes après les autres<br><i class="bi bi-circle"></i> Un gros tunnel multi-thread dans lequel les fonctions vont être parallélisées pour être exécutées de manière asynchrone<br><i class="bi bi-circle"></i> Une simple boucle  `for`  dans laquelle on exécute généralement des événements<br><i class="bi bi-circle"></i> Cela n&#x27;existe pas<br><br><p><em>On peut voir l&#x27;event loop comme étant un tunnel mono-thread dans lequel on va mettre en file d&#x27;attente des fonctions pour décaler leur
exécution.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-3--quaffiche-cet-extrait-">Question 3 : Qu’affiche cet extrait ?<a class="hash-link" href="#question-3--quaffiche-cet-extrait-" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Prems&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Deuz&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><i class="bi bi-circle"></i><code>Prems</code>, puis <code>Deuz</code><br><i class="bi bi-record-circle"></i><code>Deuz</code>, puis <code>Prems</code><br><br><p><em><code>setTimeout</code> sert à retarder l&#x27;exécution d&#x27;une fonction du temps indiqué. Il va ajouter la fonction passée en paramètre à l&#x27;event loop, et
demander à attendre un certain temps avant de l&#x27;exécuter. Si aucun temps n’est passé à la fonction (comme dans notre exemple), alors notre
callback sera exécutée au prochain tour de l’event loop, et donc après <code>Deuz</code>.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-4--quest-ce-quunecallback-">Question 4 : Qu&#x27;est-ce qu&#x27;une callback ?<a class="hash-link" href="#question-4--quest-ce-quunecallback-" title="Direct link to heading">​</a></h4><i class="bi bi-circle"></i> Une fonction qui va exécuter une autre fonction lorsqu&#x27;elle a terminé ce qu&#x27;elle devait faire<br><i class="bi bi-record-circle"></i> Une fonction qui sera exécutée par une autre fonction lorsque cette dernière aura terminé ce qu&#x27;elle devait faire<br><i class="bi bi-circle"></i> Une fonction qui va récupérer toutes les informations de navigation d&#x27;un utilisateur<br><br><p><em>La différence est subtile : une callback est une fonction (appelons-la <code>cb</code>) que l&#x27;on passe en paramètre à une autre fonction (appelons-la
<code>fn</code>). C&#x27;est <code>fn</code> qui va exécuter <code>cb</code> lorsqu&#x27;elle aura fini ce qu&#x27;elle doit faire.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-5--quest-ce-quune-promise">Question 5 : Qu&#x27;est-ce qu&#x27;une <code>Promise</code> ?<a class="hash-link" href="#question-5--quest-ce-quune-promise" title="Direct link to heading">​</a></h4><i class="bi bi-circle"></i> Une promesse que l&#x27;on ne tient jamais (comme toutes les promesses)<br><i class="bi bi-circle"></i> Un objet JavaScript qui n&#x27;aura jamais de valeur<br><i class="bi bi-record-circle"></i> Un objet JavaScript dédié aux traitements asynchrones<br><i class="bi bi-circle"></i> Une fonction qui promet d&#x27;exécuter du code dans un délai imparti<br><br><p><em>Une <code>Promise</code> est un objet JavaScript utilisé pour réaliser des traitements asynchrones tels que des appels API (GET, POST, etc.). Elle
dispose de plusieurs statuts :</em></p><ul><li><em>&quot;pending&quot;. La requête est en train d’être réalisée.</em></li><li><em>&quot;resolve&quot;. La requête a été réalisée et aucune erreur n’a eu lieu. La fonction <code>then()</code> est appelée.</em></li><li><em>&quot;reject&quot;. Une erreur est survenue et le traitement asynchrone a échoué. La fonction <code>catch()</code> est appelée.</em></li></ul><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-6--quaffiche-ce-code-">Question 6 : Qu’affiche ce code ?<a class="hash-link" href="#question-6--quaffiche-ce-code-" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">num1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">num2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">compute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> n1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">num1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> n2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">num2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> n1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> n2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">compute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“Erreur”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><i class="bi bi-record-circle"></i> 45<br><i class="bi bi-circle"></i> Une <i>Promise</i><br><i class="bi bi-circle"></i> &quot;Erreur&quot;<br><br><p><em><code>async</code> et <code>await</code> sont des mots clés du langage JavaScript qui permettent de créer du code asynchrone qui utilisera les <code>Promise</code> en
arrière-plan. Dans notre exemple, la fonction <code>compute</code> récupère le résultat des fonctions <code>num1</code> et <code>num2</code> en attendant que leur <code>Promise</code>
soit résolue (ce qui est immédiatement le cas de nos 2 fonctions car l’une renvoie directement une valeur numérique, et l’autre utilise
<code>Promise.resolve()</code> qui indique que la <code>Promise</code> est résolue).</em></p><p><em><code>compute</code> renvoie donc une <code>Promise</code> qui vaudra 45. Lorsqu’on l’appelle, ici, on utilise la fonction <code>then()</code> car <code>async</code> et <code>await</code> sont des
<code>Promise</code> en arrière-plan, et on affiche le résultat (45) dans la console.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-7--sachant-que-promise1-sera-résolue-avec-la-valeur-salut-et-que-promise2-sera-résolue-avec-toi-quaffiche-cet-extrait">Question 7 : Sachant que promise1 sera résolue avec la valeur &quot;Salut&quot;, et que promise2 sera résolue avec &quot;toi&quot;, qu’affiche cet extrait ?<a class="hash-link" href="#question-7--sachant-que-promise1-sera-résolue-avec-la-valeur-salut-et-que-promise2-sera-résolue-avec-toi-quaffiche-cet-extrait" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">promise1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> promise2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><i class="bi bi-circle"></i> [&quot;Salut&quot;, &quot;toi&quot;]<br><i class="bi bi-record-circle"></i> &quot;Salut toi&quot;<br><i class="bi bi-circle"></i> &quot;Salut&quot;<br><i class="bi bi-circle"></i> &quot;toi&quot;<br><br><p><em><code>Promise.all</code> prend en paramètre une liste de <code>Promise</code> et retourne une nouvelle <code>Promise</code> qui sera résolue une fois que toutes les <code>Promise</code>
seront résolues. Cette <code>Promise</code> contiendra le résultat de toutes les <code>Promise</code> sous forme de liste et en conservant l’ordre dans la fonction
<code>all()</code>. Ainsi, notre code affichera &quot;Salut toi&quot;.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-8--que-fait-cet-extrait-">Question 8 : Que fait cet extrait ?<a class="hash-link" href="#question-8--que-fait-cet-extrait-" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><i class="bi bi-circle"></i> Il exécute la callback au bout de 1 seconde<br><i class="bi bi-circle"></i> Il exécute la callback au bout de 1 000 secondes<br><i class="bi bi-record-circle"></i> Il exécute la callback toutes les 1 seconde<br><i class="bi bi-circle"></i> Il exécute la callback toutes les 1 000 secondes<br><br><p><em><code>setInterval</code> permet d&#x27;exécuter une fonction de callback toutes les X ms. La fonction prend le délai en millisecondes et non en secondes.</em></p><hr><h4 class="anchor anchorWithStickyNavbar_mojV" id="question-9--que-fait-ce-code-et-que-contient-la-variable-promiseres-">Question 9 : Que fait ce code et que contient la variable <code>promiseRes</code> ?<a class="hash-link" href="#question-9--que-fait-ce-code-et-que-contient-la-variable-promiseres-" title="Direct link to heading">​</a></h4><p><strong>(Dans cet extrait nous utilisons la fonction <code>reduce</code> . Elle permet de parcourir une liste et de la réduire à une seule valeur :
l’accumulateur. Pour en savoir plus, n’hésitez pas à aller faire un tour sur la <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="noopener noreferrer">documentation de la fonction</a>).</strong></p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">func1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">func2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> promiseRes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Promise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">func1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">func2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">results</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">acc</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> acc </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><i class="bi bi-record-circle"></i><code>promiseRes</code> vaut une promesse résolue avec l&#x27;identifiant de la fonction <code>setTimeout</code>, et la callback est appelée après 24 secondes<br><i class="bi bi-circle"></i><code>promiseRes</code> vaut un identifiant de <code>setTimeout</code>, et la callback est appelée après 12 secondes<br><i class="bi bi-circle"></i><code>promiseRes</code> vaut un identifiant de <code>setTimeout</code>, et la callback est appelée après 24 secondes<br><i class="bi bi-circle"></i><code>promiseRes</code> vaut une promesse résolue avec l&#x27;identifiant de la fonction <code>setTimeout</code>, et la callback est appelée après 12 secondes<br><br><p><em>Ici nous exécutons 2 fonctions asynchrones en parallèle avec <code>Promise.all</code>. La première fonction <code>then()</code> va appeler <code>reduce</code> sur la liste de
résultats (3, et 4) et multiplier les valeurs entre elles avec une valeur initiale de 2, soit : <code>2 * 3 * 4 = 24</code>.</em></p><p><em>Le résultat est passé à la prochaine fonction <code>then()</code>, qui va appeler une callback après <code>time</code> secondes, <code>time</code> correspondant ici à 24, le
résultat du précédent <code>then()</code>.</em></p><p><em>Enfin, on retourne le résultat de la fonction <code>setTimeout()</code>, <code>promiseRes</code> contient donc une <code>Promise</code> qui sera résolue avec l&#x27;identifiant de
la fonction <code>setTimeout</code> retourné.</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/gylgyl2000/Mon_Web_Dev_Wiki/edit/master/website/docs/OpenClassrooms/5-Construisez_un_site_e-commerce/3-Ecrivez_du_JavaScript_pour_le_web/3-Parallelisez_vos_longues_taches_avec_la_programmation_asynchrone.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/2-Communiquez_via_une_API_avec_un_service_web"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Communiquez via une API avec un service web</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Mon_Web_Dev_Wiki/docs/OpenClassrooms/Construisez_un_site_e-commerce/Ecrivez_du_JavaScript_pour_le_web/4-Mettez_en_place_les_bons_outils_pour_travailler"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mettez en place les bons outils pour travailler</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#comprenez-comment-fonctionne-lasynchrone-en-js" class="table-of-contents__link toc-highlight">Comprenez comment fonctionne l&#39;asynchrone en JS</a><ul><li><a href="#javascript-est-synchrone-et-mono-thread" class="table-of-contents__link toc-highlight">JavaScript est synchrone et mono-thread</a></li><li><a href="#levent-loop" class="table-of-contents__link toc-highlight">L&#39;event loop</a></li><li><a href="#jouez-avec-levent-loop" class="table-of-contents__link toc-highlight">Jouez avec l&#39;event loop</a></li><li><a href="#le-cas-de-lio" class="table-of-contents__link toc-highlight">Le cas de l&#39;I/O</a></li><li><a href="#en-résumé" class="table-of-contents__link toc-highlight">En résumé</a></li></ul></li><li><a href="#gérez-du-code-asynchrone" class="table-of-contents__link toc-highlight">Gérez du code asynchrone</a><ul><li><a href="#callbacks" class="table-of-contents__link toc-highlight">Callbacks</a></li><li><a href="#promise" class="table-of-contents__link toc-highlight">Promise</a></li><li><a href="#asyncawait" class="table-of-contents__link toc-highlight">Async/await</a></li><li><a href="#à-vous-de-jouer" class="table-of-contents__link toc-highlight">À vous de jouer !</a></li><li><a href="#en-résumé-1" class="table-of-contents__link toc-highlight">En résumé</a></li></ul></li><li><a href="#parallélisez-plusieurs-requêtes-http" class="table-of-contents__link toc-highlight">Parallélisez plusieurs requêtes HTTP</a><ul><li><a href="#enchaînez-des-requêtes-avec-les-callbacks" class="table-of-contents__link toc-highlight">Enchaînez des requêtes avec les callbacks</a></li><li><a href="#enchaînez-des-requêtes-avec-les-promise" class="table-of-contents__link toc-highlight">Enchaînez des requêtes avec les Promise</a></li><li><a href="#enchaînez-des-requêtes-avec-asyncawait" class="table-of-contents__link toc-highlight">Enchaînez des requêtes avec async/await</a></li><li><a href="#en-résumé-2" class="table-of-contents__link toc-highlight">En résumé</a></li></ul></li><li><a href="#quiz--parallélisez-vos-longues-tâches-avec-la-programmation-asynchrone" class="table-of-contents__link toc-highlight">Quiz : Parallélisez vos longues tâches avec la programmation asynchrone</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Mon_Web_Dev_Wiki/docs/menu">Menu</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Mon_Web_Dev_Wiki/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/gylgyl2000/Mon_Web_Dev_Wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Mon Wiki Dev Web, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Mon_Web_Dev_Wiki/assets/js/runtime~main.d0ff12ed.js"></script>
<script src="/Mon_Web_Dev_Wiki/assets/js/main.ebe36446.js"></script>
</body>
</html>